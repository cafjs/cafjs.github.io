<!DOCTYPE html>
<html lang="en">
<head>
    
    <meta charset="utf-8">
    <title>Home - Documentation</title>
    
    
    <script src="scripts/prettify/prettify.js"></script>
    <script src="scripts/prettify/lang-css.js"></script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc.css">
    <script src="scripts/nav.js" defer></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
</head>
<body>

<input type="checkbox" id="nav-trigger" class="nav-trigger" />
<label for="nav-trigger" class="navicon-button x">
  <div class="navicon"></div>
</label>

<label for="nav-trigger" class="overlay"></label>

<nav >
    
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-caf_cli_CreateUser.html">caf_cli/CreateUser</a><ul class='methods'><li data-type='method'><a href="module-caf_cli_CreateUser.html">newUser</a></li></ul></li><li><a href="module-caf_cli_cryptoSession.html">caf_cli/cryptoSession</a><ul class='methods'><li data-type='method'><a href="module-caf_cli_cryptoSession.html">create</a></li><li data-type='method'><a href="module-caf_cli_cryptoSession.html#authAndDecrypt">authAndDecrypt</a></li><li data-type='method'><a href="module-caf_cli_cryptoSession.html#encryptAndMAC">encryptAndMAC</a></li><li data-type='method'><a href="module-caf_cli_cryptoSession.html#getPublicKey">getPublicKey</a></li><li data-type='method'><a href="module-caf_cli_cryptoSession.html#setOtherPublicKey">setOtherPublicKey</a></li></ul></li><li><a href="module-caf_cli_main.html">caf_cli/main</a></li><li><a href="module-caf_cli_Queue.html">caf_cli/Queue</a></li><li><a href="module-caf_cli_Session.html">caf_cli/Session</a><ul class='methods'><li data-type='method'><a href="module-caf_cli_Session.html">deleteTokenFromURL</a></li><li data-type='method'><a href="module-caf_cli_Session.html">extractSpecFromURL</a></li><li data-type='method'><a href="module-caf_cli_Session.html">extractTokenFromURL</a></li><li data-type='method'><a href="module-caf_cli_Session.html">getMethodArgs</a></li><li data-type='method'><a href="module-caf_cli_Session.html#changeSessionId">changeSessionId</a></li><li data-type='method'><a href="module-caf_cli_Session.html#close">close</a></li><li data-type='method'><a href="module-caf_cli_Session.html#getCacheKey">getCacheKey</a></li><li data-type='method'><a href="module-caf_cli_Session.html#getCrypto">getCrypto</a></li><li data-type='method'><a href="module-caf_cli_Session.html#getEstimatedTimeOffset">getEstimatedTimeOffset</a></li><li data-type='method'><a href="module-caf_cli_Session.html#getPromise">getPromise</a></li><li data-type='method'><a href="module-caf_cli_Session.html#isClosed">isClosed</a></li><li data-type='method'><a href="module-caf_cli_Session.html#numPending">numPending</a></li><li data-type='method'><a href="module-caf_cli_Session.html">patchURL</a></li><li data-type='method'><a href="module-caf_cli_Session.html">Session</a></li></ul></li><li><a href="module-caf_cli_TimeAdjuster.html">caf_cli/TimeAdjuster</a><ul class='methods'><li data-type='method'><a href="module-caf_cli_TimeAdjuster.html#endRequest">endRequest</a></li><li data-type='method'><a href="module-caf_cli_TimeAdjuster.html#offset">offset</a></li><li data-type='method'><a href="module-caf_cli_TimeAdjuster.html#startRequest">startRequest</a></li><li data-type='method'><a href="module-caf_cli_TimeAdjuster.html">TimeAdjuster</a></li></ul></li><li><a href="module-caf_cli_TokenFactory.html">caf_cli/TokenFactory</a><ul class='methods'><li data-type='method'><a href="module-caf_cli_TokenFactory.html#newToken">newToken</a></li><li data-type='method'><a href="module-caf_cli_TokenFactory.html">TokenFactory</a></li></ul></li></ul><h3>Externals</h3><ul><li><a href="external-caf_ca.html">caf_ca</a></li><li><a href="external-caf_session.html">caf_session</a></li><li><a href="external-caf_sharing.html">caf_sharing</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<div id="main">
    

    



    


    <section class="package">
        <h3>caf_cli 0.4.2</h3>		
    </section>









    



    <section class="readme usertext">
        <article><h1>Caf.js</h1>
<p>Co-design cloud assistants with your web app and IoT devices.</p>
<p>See https://www.cafjs.com</p>
<h2>Client Library</h2>
<p><a href="https://travis-ci.org/cafjs/caf_cli"><img src="https://travis-ci.org/cafjs/caf_cli.svg?branch=master" alt="Build Status"></a></p>
<p>This repository contains a <code>Caf.js</code> client library for browser (using <code>browserify</code> and native websockets), cloud, scripting, and gadget (<code>node.js</code>).</p>
<p>The interface is similar to the websocket client API, but <code>Caf.js</code> dynamically extends it with remote methods and local argument checking.</p>
<p>For example, with the CA:</p>
<pre class="prettyprint source"><code>exports.methods = {
    async __ca_init__() {
        this.state.counter = 0;
        return [];
    },
    async increment() {
        this.state.counter = this.state.counter + 1;
        return [null, this.state.counter];
    },
    async decrement() {
        this.state.counter = this.state.counter - 1;
        return [null, this.state.counter];
    }
};
</code></pre>
<p>and the client code:</p>
<pre class="prettyprint source"><code>var URL = 'http://root-hello.vcap.me:3000/#from=foo-ca1&ca=foo-ca1';
var s = new caf_cli.Session(URL);
s.onopen = async () => {
    try {
        let counter = await s.increment().getPromise();
        console.log(counter);
        counter = await s.decrement().getPromise();
        console.log('Final count:' + counter);
        s.close();
    } catch (ex) {
        s.close(ex);
    }
}
s.onclose = (err) => {
    if (err) {
        console.log(myUtils.errToPrettyStr(err));
        process.exit(1);
    }
    console.log('Done OK');
};
</code></pre>
<p>The methods <code>increment</code> and <code>decrement</code> magically appear in <code>s</code> after we open the session. <strong>I love JavaScript!</strong></p>
<p>Remote invocations are always serialized, i.e., the session object locally buffers new requests until the previous ones have been processed. The session properties can be configured in the URL, or in an extra constructor argument. See <a href="module-caf_cli_Session.html">module:caf_cli/Session</a> for details.</p>
<h3>Errors</h3>
<p>There are two types of errors:</p>
<ul>
<li>
<p>Application error: propagated in the callback or exception in <code>await</code>, no attempt to recover it, your logic knows best how to handle it.</p>
</li>
<li>
<p>System error: after all the attempts to recover fail, the error is propagated in the <code>onclose</code> handler. The session is no longer usable.</p>
</li>
</ul>
<p>Triggering the <code>onclose</code> with no argument means the session closed normally, i.e., using its <code>close()</code> method.</p>
<p>Note that the <code>onerror</code> handler in the websocket interface is for <em>internal use</em> only. Just use <code>onclose</code>.</p>
<h3>Multi-method</h3>
<p>In some cases we want to execute multiple methods in a single transaction (see <a href="external-caf_ca.html">external:caf_ca</a>). If one fails, we roll back all state changes and (delayed) external interactions.</p>
<p>This is easy in <code>Caf.js</code>, because methods that do not provide a callback are assumed to be multi-method calls:</p>
<pre class="prettyprint source"><code>...
s.onopen = async function() {
    try {
        const counter = await s.increment().decrement().getPromise();
        console.log('Final count:' + counter);
        s.close();
    } catch (err) {
        s.close(err);
    }
}
...
</code></pre>
<h3>Notifications</h3>
<p>The CA can also send notifications to one (or many) client(s), see
<a href="external-caf_session.html">external:caf_session</a> for details. Notifications are processed in the <code>onmessage</code> handler:</p>
<pre class="prettyprint source"><code>...
s.onmessage = function(msg) {
    const notif = caf_cli.getMethodArgs(msg)[0];
    console.log('Got notification in client:' + notif);
};
...
</code></pre>
<p>See <code>examples/helloworld</code> for full code examples.</p>
<h3>Other</h3>
<p>Session objects also provide end-to-end encryption and time synchronization. See <a href="module-caf_cli_cryptoSession.html">module:caf_cli/cryptoSession</a> and <a href="module-caf_cli_TimeAdjuster.html">module:caf_cli/TimeAdjuster</a>.</p></article>
    </section>






    
    
</div>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.6.6</a> on Thu Apr 29 2021 14:11:00 GMT-0700 (Pacific Daylight Time) using the <a href="https://github.com/clenemt/docdash">docdash</a> theme.
</footer>

<script>prettyPrint();</script>
<script src="scripts/polyfill.js"></script>
<script src="scripts/linenumber.js"></script>



</body>
</html>