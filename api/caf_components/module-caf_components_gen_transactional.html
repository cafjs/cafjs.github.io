<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: caf_components/gen_transactional</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: caf_components/gen_transactional</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>A transactional plug to manage internal state safely.</p>
<p>CAF goal is to create and manage billions of long running, active, stateful
proxies, i.e., CAs, where &quot;long running&quot; means years. In order to tolerate
 -without human intervention- failures, upgrades, migration, or other errors,
the CA state has to be managed carefully.</p>
<p>A complication is that CA state is not only application state, but state
associated with the plugins that the application uses.</p>
<p>Also, CAF always ensures that CA state is consistent with
the externalized view of that state, i.e., CA actions that affect the
external world.</p>
<p>For example, if a CA sends a message, and it keeps track of
sent messages in its internal state, even in the presence of failures
it should never forget that it sent that message.</p>
<p>CAF approach assumes:</p>
<ol>
<li><p>Operations that affect the external world are mediated by a
plugin that makes them idempotent.</p>
</li>
<li><p>Plugins defer these operations until commit time, ensuring that, before
execution, a persistent record of them has been checkpointed to an external
service.</p>
</li>
<li><p>All plugins and application code coordinate using a two-phase commit
protocol, so that disaggregated state is managed consistently.</p>
</li>
<li><p>During recovery the last committed state is reloaded, and deferred
operations in the checkpoint are retried until they succeed.</p>
</li>
</ol>
<p>Methods <code>__ca_setLogActionsTarget__</code> and  <code>__ca_lazyApply__</code> defer methods.</p>
<p>Methods <code>__ca_init__</code> and  <code>__ca_resume__</code> handle initialization and
recovery.</p>
<p>Methods <code>__ca_begin__</code>,  <code>__ca_prepare__</code>, <code>__ca_commit__</code> and <code>__ca_abort__</code>
implement the two-phase commit protocol.</p></div>
        

        
            















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line17">line 17</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
    
    </div>

    
        <h3 class="subsection-title">Extends</h3>

        


    <ul>
        <li><a href="module-caf_components_gen_container.html">module:caf_components/gen_container</a></li>
    </ul>


    

    

    

     

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="__ca_isTransactional__"><span class="type-signature"></span>__ca_isTransactional__<span class="type-signature"> :boolean</span></h4>




<div class="description">
    <p>Run-time type information.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">boolean</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line132">line 132</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    <h4 class="name" id="__ca_abort__"><span class="type-signature"></span>__ca_abort__<span class="signature">(cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Aborts the transaction.</p>
<p>CAF calls this method when an error was returned
by the handler, or any transactional plugs propagated an error during
 <code>prepare</code>.</p>
<p>Note that an error during remote checkpointing cannot
guarantee that the checkpoint was not made durable, and we need to
assume that it did. This means that we need to shutdown the CA.</p>
<p>An implementation of this method should undo state changes and
ignore deferred operations.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue after aborting.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line349">line 349</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_begin__"><span class="type-signature"></span>__ca_begin__<span class="signature">(msg, cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Begins a two phase commit transaction.</p>
<p>CAF calls this method before the application handler processes
a message. A read-only copy of the message is passed as an argument
to facilitate configuration.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>msg</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>The message to be processed.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue the transaction.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line253">line 253</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_commit__"><span class="type-signature"></span>__ca_commit__<span class="signature">(cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Commits the transaction.</p>
<p>Called by CAF when all the <code>prepare</code> calls to transactional
plugs were successful, and the new state of those plugs has been
checkpointed using an external service.</p>
<p>An error during commit will shutdown the CA since we cannot abort
committed transactions. See
<a href="module-caf_components_gen_transactional.html#__ca_resume__">module:caf_components/gen_transactional#__ca_resume__</a> for
the recovery strategy.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue after commiting.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line315">line 315</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_init__"><span class="type-signature"></span>__ca_init__<span class="signature">(cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Initializes the state of this plug from scratch.</p>
<p>This method is called only once, when the plug is created.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue after initialization.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line198">line 198</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_lazyApply__"><span class="type-signature"></span>__ca_lazyApply__<span class="signature">(method, args)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Queues an operation to be executed at commit time.</p>
<p>Internally, operations are made asynchronous and executed serially by
adding an extra callback. The actual implementation of these operations
is delegated to the <code>logActionsTarget</code> object.</p>
<p>Operations are assumed to be idempotent.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>method</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>A method name to execute.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>args</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;Any></span>


            
            </td>

            

            

            <td class="description last"><p>An array of method arguments.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line183">line 183</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_prepare__"><span class="type-signature"></span>__ca_prepare__<span class="signature">(cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Prepares to commit the transaction.</p>
<p>CAF calls this method after the handler has succesfully
processed the message.</p>
<p>If ready to commit, it returns in the callback a JSON
serializable data structure reflecting the new state after
processing the message.</p>
<p>Then, CAF checkpoints this data structure using a remote service.</p>
<p>To abort the transaction we return an error in the (node.js) callback.
This will abort all the transactional plugs associated with the CA.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue or abort the transaction.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line282">line 282</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_resume__"><span class="type-signature"></span>__ca_resume__<span class="signature">(cp, cb)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Reloads the state of this plug from a previous checkpoint.</p>
<p>It also retries deferred operations in the checkpoint.</p>
<p>This method is called many times, for example, after
recovering  from a failure or restarting after migration.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>cp</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>The last checkpoint of the state of this plug.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>cb</code></td>
            

            <td class="type">
            
                
<span class="param-type">caf.cb</span>


            
            </td>

            

            

            <td class="description last"><p>A callback to continue after resuming.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line221">line 221</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
            

    

    <h4 class="name" id="__ca_setLogActionsTarget__"><span class="type-signature"></span>__ca_setLogActionsTarget__<span class="signature">(obj)</span><span class="type-signature"></span></h4>

    



<div class="description">
    <p>Sets a receiver object implementing all the delayed methods.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>obj</code></td>
            

            <td class="type">
            
                
<span class="param-type">Object</span>


            
            </td>

            

            

            <td class="description last"><p>A receiver for delayed methods.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="gen_transactional.js.html">gen_transactional.js</a>, <a href="gen_transactional.js.html#line163">line 163</a>
    </li></ul></dd>
    

    

    

    
</dl>
















        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-caf_components_containerUtils.html">caf_components/containerUtils</a></li><li><a href="module-caf_components_gen_component.html">caf_components/gen_component</a></li><li><a href="module-caf_components_gen_container.html">caf_components/gen_container</a></li><li><a href="module-caf_components_gen_cron.html">caf_components/gen_cron</a></li><li><a href="module-caf_components_gen_dynamic_container.html">caf_components/gen_dynamic_container</a></li><li><a href="module-caf_components_gen_loader.html">caf_components/gen_loader</a></li><li><a href="module-caf_components_gen_plug.html">caf_components/gen_plug</a></li><li><a href="module-caf_components_gen_plug_ca.html">caf_components/gen_plug_ca</a></li><li><a href="module-caf_components_gen_proxy.html">caf_components/gen_proxy</a></li><li><a href="module-caf_components_gen_supervisor.html">caf_components/gen_supervisor</a></li><li><a href="module-caf_components_gen_transactional.html">caf_components/gen_transactional</a></li><li><a href="module-caf_components_main.html">caf_components/main</a></li><li><a href="module-caf_components_myUtils.html">caf_components/myUtils</a></li><li><a href="module-caf_components_naming.html">caf_components/naming</a></li><li><a href="module-caf_components_plug_ca_log.html">caf_components/plug_ca_log</a></li><li><a href="module-caf_components_plug_log.html">caf_components/plug_log</a></li><li><a href="module-caf_components_proxy_log.html">caf_components/proxy_log</a></li><li><a href="module-caf_components_supervisor.html">caf_components/supervisor</a></li><li><a href="module-caf_components_templateUtils.html">caf_components/templateUtils</a></li></ul>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.4.3</a> on Thu Feb 02 2017 23:58:42 GMT-0800 (PST)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>