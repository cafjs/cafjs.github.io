<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>JSDoc: Module: caf_sharing/ReliableChannel</title>

    <script src="scripts/prettify/prettify.js"> </script>
    <script src="scripts/prettify/lang-css.js"> </script>
    <!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    <link type="text/css" rel="stylesheet" href="styles/prettify-tomorrow.css">
    <link type="text/css" rel="stylesheet" href="styles/jsdoc-default.css">
</head>

<body>

<div id="main">

    <h1 class="page-title">Module: caf_sharing/ReliableChannel</h1>

    




<section>

<header>
    
        
            
        
    
</header>

<article>
    <div class="container-overview">
    
        
            <div class="description"><p>A collection of helper functions to create a reliable, unidirectional
channel from <code>A</code> to <code>B</code>, using a pair of Shared Maps.</p>
<p>One Shared Map (the <code>writer</code>) is writable by <code>A</code> and readable by <code>B</code>.
The other one (the <code>reader</code>) is writable by <code>B</code> and readable by <code>A</code>.
<code>B</code> writes index numbers in its map  to
acknowledge messages, helping <code>A</code> to garbage collect old messages.</p>
<p>A channel is represented by an unbounded list of messages. However, only
those that have not been acknowledged are actually present in the Shared Map.</p>
<p>The schema is as follows:</p>
<p>In the <code>writer</code> map:</p>
<pre><code>{
    __ca_channels__ : {
       foo : {
           contents:[...],
           index : &lt;number&gt; i.e., index of first msg in `contents`
        }
    }
}
</code></pre>
<p>in the <code>reader</code> map:</p>
<pre><code>{
     __ca_acks__ : {
       foo : &lt;number&gt;  (i.e., index of last processed message of 'foo')
     }
}
</code></pre>
<p>The first message has index 0.</p>
<p>When <code>B</code> consumes all the messages, it resets the ack index to
<code>foo.index + foo.contents.length -1</code> .</p>
<p>When <code>A</code> garbage collects the channel, it drops all the acknowledged messages
by comparing <code>__ca_channels__.foo.index</code> with <code>__ca_acks__.foo</code>, and
shifting the list.</p></div>
        

        
            















<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line19">line 19</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
    
    </div>

    

    

    

    

    

    

    
        <h3 class="subsection-title">Members</h3>

        
            
<h4 class="name" id="UNKNOWN_ACK_INDEX"><span class="type-signature"></span>UNKNOWN_ACK_INDEX<span class="type-signature"> :number</span></h4>




<div class="description">
    <p>Invalid ack index.</p>
</div>



    <h5>Type:</h5>
    <ul>
        <li>
            
<span class="param-type">number</span>


        </li>
    </ul>





<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line83">line 83</a>
    </li></ul></dd>
    

    

    

    
</dl>






        
    

    
        <h3 class="subsection-title">Methods</h3>

        
            

    

    
    <h4 class="name" id="allChannelNames"><span class="type-signature"></span>allChannelNames<span class="signature">(writerRef)</span><span class="type-signature"> &rarr; {Array.&lt;string>}</span></h4>
    

    



<div class="description">
    <p>Lists all channel names in a Shared Map.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A reference to a writable Shared Map.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line175">line 175</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>All the channel names.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">Array.&lt;string></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="deleteChannel"><span class="type-signature"></span>deleteChannel<span class="signature">(writerRef, channelName)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Deletes a channel in a Shared Map.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A reference to a writable Shared Map.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The name of the channel.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line114">line 114</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="firstAckIndex"><span class="type-signature"></span>firstAckIndex<span class="signature">(readerRef, channelName)</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Returns the index of the last ack message.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>readerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A reference to a writable Shared Map for
acks.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The name of the channel.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line159">line 159</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>The index of the last ack message.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="firstIndex"><span class="type-signature"></span>firstIndex<span class="signature">(writerRef, channelName)</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Returns the index of the first message available in the channel.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A reference to a writable Shared Map.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The name of the channel.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line140">line 140</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>The index of the first message available in the channel.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="gc"><span class="type-signature"></span>gc<span class="signature">(writerRef, readerRef)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Garbage collects acknowledged messages.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A writable map with messages.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>readerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A read-only map with ack counters.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line222">line 222</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="init"><span class="type-signature"></span>init<span class="signature">(writerRef)</span><span class="type-signature"></span></h4>
    

    



<div class="description">
    <p>Initializes a Shared Map containing reliable channels.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A reference to a writable Shared Map.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line94">line 94</a>
    </li></ul></dd>
    

    

    

    
</dl>




















        
            

    

    
    <h4 class="name" id="receive"><span class="type-signature"></span>receive<span class="signature">(writerRef, readerRef, channelName)</span><span class="type-signature"> &rarr; {<a href="global.html#messagesType">messagesType</a>}</span></h4>
    

    



<div class="description">
    <p>Receives messages and updates ack counters accordingly. This operation is
not idempotent, already acknowledged messages are ignored.</p>
<p>The return type 'messagesType' is:</p>
<pre><code>  {index: number, messages: Array.&lt;jsonType&gt;}
</code></pre>
<p>where the <code>index</code> field corresponds to the first message in <code>messages</code> or
UNKNOWN_ACK_INDEX if no messages.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A writable map ack counters.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>readerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A read-only map with messages.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The name of the channel to receive messages from.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line269">line 269</a>
    </li></ul></dd>
    

    

    

    
</dl>















<h5>Returns:</h5>

        
<div class="param-desc">
    <p>Messages received in the channel that have not been
acknowledged previously.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type"><a href="global.html#messagesType">messagesType</a></span>


    </dd>
</dl>

    





        
            

    

    
    <h4 class="name" id="send"><span class="type-signature"></span>send<span class="signature">(writerRef, channelName, messages)</span><span class="type-signature"> &rarr; {number}</span></h4>
    

    



<div class="description">
    <p>Sends an array of messages through a channel.</p>
</div>









    <h5>Parameters:</h5>
    

<table class="params">
    <thead>
    <tr>
        
        <th>Name</th>
        

        <th>Type</th>

        

        

        <th class="last">Description</th>
    </tr>
    </thead>

    <tbody>
    

        <tr>
            
                <td class="name"><code>writerRef</code></td>
            

            <td class="type">
            
                
<span class="param-type"><a href="global.html#refMapType">refMapType</a></span>


            
            </td>

            

            

            <td class="description last"><p>A writable map with messages.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>channelName</code></td>
            

            <td class="type">
            
                
<span class="param-type">string</span>


            
            </td>

            

            

            <td class="description last"><p>The name of the channel.</p></td>
        </tr>

    

        <tr>
            
                <td class="name"><code>messages</code></td>
            

            <td class="type">
            
                
<span class="param-type">Array.&lt;<a href="global.html#jsonType">jsonType</a>></span>


            
            </td>

            

            

            <td class="description last"><p>An array of JSON-serializable messages
to be sent.</p></td>
        </tr>

    
    </tbody>
</table>






<dl class="details">

    

    

    

    

    

    

    

    

    

    

    

    

    
    <dt class="tag-source">Source:</dt>
    <dd class="tag-source"><ul class="dummy"><li>
        <a href="ReliableChannel.js.html">ReliableChannel.js</a>, <a href="ReliableChannel.js.html#line194">line 194</a>
    </li></ul></dd>
    

    

    

    
</dl>













<h5>Throws:</h5>

        

    <div class="param-desc">
    
        <p>Error If <code>messages</code> is not an array or is empty.</p>
    
    </div>


    


<h5>Returns:</h5>

        
<div class="param-desc">
    <p>An index for the first message in <code>messages</code>.</p>
</div>



<dl>
    <dt>
        Type
    </dt>
    <dd>
        
<span class="param-type">number</span>


    </dd>
</dl>

    





        
    

    

    
</article>

</section>




</div>

<nav>
    <h2><a href="index.html">Home</a></h2><h3>Modules</h3><ul><li><a href="module-caf_sharing_AggregateMap.html">caf_sharing/AggregateMap</a></li><li><a href="module-caf_sharing_main.html">caf_sharing/main</a></li><li><a href="module-caf_sharing_plug_ca_sharing.html">caf_sharing/plug_ca_sharing</a></li><li><a href="module-caf_sharing_plug_sharing.html">caf_sharing/plug_sharing</a></li><li><a href="module-caf_sharing_proxy_sharing.html">caf_sharing/proxy_sharing</a></li><li><a href="module-caf_sharing_ReliableChannel.html">caf_sharing/ReliableChannel</a></li><li><a href="module-caf_sharing_SharedMap.html">caf_sharing/SharedMap</a></li></ul><h3>Externals</h3><ul><li><a href="external-caf_ca.html">caf_ca</a></li><li><a href="external-caf_components_gen_plug.html">caf_components/gen_plug</a></li><li><a href="external-caf_components_gen_plug_ca.html">caf_components/gen_plug_ca</a></li><li><a href="external-caf_components_gen_proxy.html">caf_components/gen_proxy</a></li><li><a href="external-caf_redis.html">caf_redis</a></li></ul><h3><a href="global.html">Global</a></h3>
</nav>

<br class="clear">

<footer>
    Documentation generated by <a href="https://github.com/jsdoc/jsdoc">JSDoc 3.6.3</a> on Sat Dec 07 2019 23:28:32 GMT-0800 (Pacific Standard Time)
</footer>

<script> prettyPrint(); </script>
<script src="scripts/linenumber.js"> </script>
</body>
</html>